NimbusServer Build Process

1.	Download CentOS 7 DVD ISO from one of the mirror sites
2.	Run the VMware Workstation New Virtual Machine Wizard
    a.	Select Typical (recommended) configuration
    b.	Select Installer disc image file (ISO)
    c.	Enter NimbusServer as the virtual machine name
    d.	Enter 300 as the Maximum disk size (GB) and select Split virtual disk into multiple files
    e.	Customize the VM hardware settings:
        i.	10GB memory
        ii.	1 processor with 4 processor cores
        iii.	Remove the Sound Card and Printer
    f.	Close the window, check Power on this virtual machine after creation and click Finish
    g.	Run the installation process
        i.	Set correct values for Language, along with Date & Time
        ii.	Within Software Selection, select GNOME Desktop
        iii.	Within Installation Destination select I will configure partitioning
        iv.	Within Manual Partitioning click Click here to create them automatically
            1.	Change cl-home to 30.12 GiB
            2.	Change cl-root to 264 GiB
            3.	Click Done and Accept changes
        v.	Within Network & Host Name, set the host name to nimbusserver  and turn on the NAT network
        vi.	Click Begin Installation
        vii.	Set the Root Password to Password1
        viii.	Click on User Creation
            1.	Full name: demo
            2.	User name: demo
            3.	Check the box for Make this user administrator
            4.	Password: Password1
        ix.	Click Reboot when prompted
        x.	Accept license information
        xi.	Click Finish Configuration
        xii.	Log in and click through final configuration screens
        xiii.	On VMware Workstation, click on I Finished Installing
        xiv.	Disable SELinux
            1.	sudo vi /etc/sysconfig/selinux
            2.	Change SELINUX=enforcing to SELINUX=disabled
        xv.	Disable the firewall
            1.	sudo systemctl disable firewalld
        xvi.	In network settings, make sure all networks Connect automatically in the Identity section of their individual settings icon
        xvii.	Modify the hosts file with sudo vi /etc/hosts
            1.	172.50.0.1	nimbusserver nimbusserver.aos.com dockerserver
            2.	172.16.10.64	nimbusclient
        xviii.	Wait for software updates to be ready and then install them using the Application Installer
        xix.	Shut down and remove the CD/DVD Drive using Virtual Machine Settings and then Power on this virtual machine to continue
        xx.	Ensure all software is up to date with sudo yum update
        xxi.	Turn off automatic updates with sudo systemctl mask packagekit.service

3.	Configure the desktop
    a.	Using Tweak Tool:
        i.	Under Desktop, turn on Icons on Desktop, uncheck all icons except Trash
        ii.	Under Power, change Power Button Action to Nothing
        iii.	Under Power, turn on Don’t suspend on lid close (Access Denied Error)
        iv.	Under Top Bar, turn off Show Application Menu and select Show date
        v.	Under Workspaces, set the number to 1
    b.	Under Desktop, select the solid blue background
    c.	Mute the audio volume
    d.	In Displays settings, set display to 1440x900
    e.	In Power settings, set Blank screen to Never
    f.	In Date & Time settings, set time to AM/PM
    g.	Set terminal profile to 132x40
    h.	Set Files to show icons at 50%, sort by Type and Sort folders before files
4.	Allow drag and drop with sudo chmod 777 /home/demo/.cache/vmware/drag_and_drop
5.	Install the required kernel-devel package for NV with sudo yum install kernel-devel
6.	Install telnet with sudo yum install telnet –y
7.	Install dos2unix with sudo yum install dos2unix
8.	Install exfat utilities
    a.	sudo yum install -y http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-1.el7.nux.noarch.rpm
    b.	sudo yum install exfat-utils fuse-exfat
9.	Install xrdp
    a.	sudo rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm
    b.	sudo yum -y install xrdp
    c.	sudo systemctl start xrdp.service
    d.	sudo systemctl enable xrdp.service
    e.	Modify /etc/xrdp/sesman.ini and set MaxSessions=1
10.	Install Git and Maven with sudo yum install git and sudo yum install maven
11.	Install Chrome
    a.	Create a file using sudo vi /etc/yum.repos.d/google-chrome.repo with the following contents:
        i.	[google-chrome]
        ii.	name=google-chrome
        iii.	baseurl=http://dl.google.com/linux/chrome/rpm/stable/$basearch
        iv.	enabled=1
        v.	gpgcheck=1
        vi.	gpgkey=https://dl-ssl.google.com/linux/linux_signing_key.pub
    b.	sudo yum install google-chrome-stable
    c.	Enable chrome://flags for silent debugging – (Add to start flags)
    d.	Install the Functional Testing Agent from the Chrome store, making sure the agent is enabled
    e.	Show home button
    f.	start in about:blank,
    g.	delete other extensions why? – Deleting the default icons stops pdf’s form being opened in chrome in theory. Is there something specific we don’t like?
    h.	turn password manager off
    i.	Show bookmarks bar
    j.	add bookmarks from the chrome.html file
12.	Install Docker, add user demo to the Docker group and create the Docker network
    a.	sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
    b.	sudo yum install docker-ce
    c.	sudo systemctl start docker
    d.	sudo usermod -aG docker demo
    e.	sudo systemctl enable docker
    f.	Restart Nimbus Server
    g.	docker network create --subnet 172.50.0.0/16 --gateway 172.50.0.1 demo-net
13.	Install Docker Compose as root:
    a.	su
    b.	curl -L https://github.com/docker/compose/releases/download/1.16.1/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
    c.	chmod +x /usr/local/bin/docker-compose
    d.	docker-compose -version
    e.	exit
14.	Configure SSH
    a.	sudo mkdir /root/.ssh and copy the SSH keys into it
    b.	sudo chown -R root:root /root/.ssh
    c.	sudo chmod 600 /root/.ssh/id_rsa and authorized_keys
    d.	sudo chmod 644 /root/.ssh/id_rsa.pub
15.	Install FileZilla with sudo yum install filezilla
16.	Add Firefox desktop icon and configure Firefox,
    a.	 import Chrome bookmarks
    b.	 Enable Bookmarks Toolbar
    c.	install HPE Functional Testing Agent to Extensions
17.	Copy Remote Desktop Viewer to LeanFT Viewer and configure the Command property as vinagre ::5900
18.	Add --password-store=basic before the %U on the /usr/share/applications/google-chrome.desktop file – Seems redundant since passwords are disabled by step 11h
19.	Use the Activities Overview to manage Favorites and add desktop icons, including System Monitor
20.	Copy the build.log to the Documents folder and chmod 644
21.	Update all software with sudo yum update
22.	Delete Chrome and Firefox history
23.	 cat /dev/null > ~/.bash_history && history -c && exit
24.	Set memory, processors and virtual machine name
25.	Turn on automatic login

Maybe turn off virtualization services with /bin/systemctl disable libvirtd.service

